# JustDetox

A free, open-source Chrome extension (Manifest V3) that blocks or time-limits websites to help you focus.

---

## Features

- **Block mode** — hard-block a site entirely; overlay shown on every visit
- **Time-limit mode** — allow N minutes per reset window; block when quota is exhausted
- **Groups** — bundle sites into a shared time pool (e.g. "Social Media = 60 min/day")
- **Per-site overrides** — granular rules on top of groups
- **Master disable toggle** — pause all blocking without touching your rules
- Usage reset window: 6 h / 12 h / 24 h / 48 h (configurable)
- Minimal permissions: `storage`, `tabs`, `alarms` only — no `<all_urls>` host permissions
- No accounts, no telemetry — all data stays in your browser
- Dark theme UI built with React + TypeScript

---

## How to run (development)

### Prerequisites

- Node.js ≥ 18
- npm ≥ 9

### Install dependencies

```bash
npm install
```

### Build

```bash
npm run build
```

This outputs the unpacked extension to `dist/`.

### Load unpacked in Chrome

1. Open Chrome and navigate to `chrome://extensions`
2. Enable **Developer mode** (toggle in the top-right corner)
3. Click **Load unpacked**
4. Select the `dist/` folder inside this repo
5. The JustDetox icon will appear in your toolbar

---

## Permissions

| Permission | Why it is needed |
|------------|-----------------|
| `storage` | Persist blocking rules and per-domain usage counters in `chrome.storage.local` |
| `tabs` | Read the active tab's URL to enforce rules; open the options/onboarding page on install |
| `alarms` | Drive the 30-second usage-flush cycle and the configurable reset window |

No host permissions are requested. The content script is declared statically in the manifest and only injects an overlay element when a block condition is met.

---

## Project structure

```
src/
  background/     # Service worker (block checks, alarm-based usage reset)
  content/        # Content script (overlay injection, 30-second time ping)
  core/           # Pure logic: types, storage, validation, policy, matching
  ui/
    popup/        # Toolbar popup (React) — quick status view
    options/      # Full settings page (React, opens in a tab)
    onboarding/   # First-run welcome page (React, opens on install)
public/
  manifest.json
  icons/          # Generated by scripts/generate-icons.js
  blocked.html    # Static blocked-page (web-accessible resource)
scripts/
  generate-icons.js  # Regenerates PNG icons from source (no external deps)
dist/             # Built output — load this as unpacked extension
```

---

## Scripts

| Command | Description |
|---|---|
| `npm run build` | Production build → `dist/` |
| `npm run dev` | Dev server (Vite HMR — for UI iteration only) |
| `npm run lint` | ESLint check |
| `npm run format` | Prettier format |
| `npm run typecheck` | TypeScript type-check without emitting |
| `npm test` | Vitest unit tests |

### Regenerate icons

```bash
node scripts/generate-icons.js
```

---

## Manual E2E test checklist

Load the built extension in Chrome and verify each scenario before release.

### 1 — Active tab time counting

1. Open the options page → Dashboard (or click **Dashboard** in the popup).
2. Visit `example.com` for ~30 seconds, then switch back to the options tab.
3. Click **↻ Refresh**.
4. Confirm `example.com` appears in **Top sites** with ≥ 25 s of tracked time.

### 2 — Time limit triggers overlay

1. Create a site rule: `example.com`, mode = **Time-limit**, 1 minute.
2. Visit `example.com` and leave it active for at least 1 minute.
3. Confirm the JustDetox overlay appears blocking the page.
4. Open the popup — status badge should read **Blocked** with remaining time = 0.

### 3 — Group precedence

1. Create a group `Test Group` with `example.com`, mode = **Block**.
2. Also add a per-site override for `example.com`, mode = **Time-limit**, 60 minutes (less restrictive).
3. Visit `example.com`.
4. Confirm the **block** overlay appears — group rule takes precedence.

### 4 — Master disable toggle

1. In the options page → Settings, toggle **Enable JustDetox** off.
2. The sidebar status indicator should change from **Active** to **Disabled**.
3. Visit a domain that has a block rule.
4. Confirm no overlay appears and browsing is unrestricted.
5. Re-enable the toggle; confirm blocking resumes on next page load.

---

## Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md) for code conventions, PR checklist, and the design philosophy.

---

## Security

See [SECURITY.md](SECURITY.md) for the permissions rationale, threat model, and vulnerability reporting process.

---

## License

MIT
